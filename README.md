# دليل التخزين المحلي - Stack Exchange App

## 📱 نظرة عامة

هذا التطبيق يستخدم التخزين المحلي (SQLite) لحفظ البيانات وتوفير تجربة مستخدم أفضل حتى عند عدم وجود اتصال بالإنترنت.

## 🔧 المكونات الرئيسية

### 1. قاعدة البيانات المحلية
- **الملف**: `lib/features/questions/data/datasources/local/questions_local_db.dart`
- **المسؤولية**: إدارة قاعدة البيانات SQLite المحلية
- **الوظائف**:
  - `insertQuestion()`: إضافة سؤال جديد
  - `getAllQuestions()`: جلب جميع الأسئلة المحفوظة
  - `clearQuestions()`: مسح جميع البيانات

### 2. Repository Pattern
- **الملف**: `lib/features/questions/data/repos/question_repository_impl.dart`
- **المسؤولية**: تنسيق بين المصادر المحلية والبعيدة
- **الاستراتيجية**:
  1. فحص الاتصال بالإنترنت
  2. جلب البيانات المحلية إذا طُلب ذلك
  3. جلب البيانات من الإنترنت وحفظها محلياً
  4. استخدام البيانات المحلية كنسخة احتياطية

### 3. State Management
- **الملف**: `lib/features/questions/presentation/manager/question/question_cubit.dart`
- **المسؤولية**: إدارة حالة البيانات وعمليات التخزين المحلي

## 🚀 كيفية الاستخدام

### تحميل البيانات المحلية
```dart
// تحميل البيانات المحلية فقط
await questionCubit.fetchQuestions(fromLocal: true);

// تحميل البيانات المحلية أولاً ثم تحديثها من الإنترنت
await questionCubit.fetchQuestions(fromLocal: true);
questionCubit.fetchQuestions(isRefresh: true);
```

### مسح البيانات المحلية
```dart
// مسح جميع البيانات المحلية
await questionCubit.clearLocalData();

// الحصول على عدد البيانات المحلية
int count = await questionCubit.getLocalDataCount();
```

### البحث في البيانات المحلية
```dart
// البحث في البيانات المحلية أولاً
questionCubit.search("query");
```

## 🔄 استراتيجية التخزين

### عند بدء التطبيق:
1. **تحميل البيانات المحلية** أولاً (سريع)
2. **تحديث البيانات من الإنترنت** في الخلفية
3. **حفظ البيانات الجديدة** في التخزين المحلي

### عند عدم وجود اتصال:
1. **فحص الاتصال** باستخدام `NetworkChecker`
2. **استخدام البيانات المحلية** إذا كانت متوفرة
3. **إظهار رسالة خطأ** إذا لم تكن هناك بيانات محلية

### عند البحث:
1. **البحث في البيانات المحلية** أولاً
2. **البحث في الإنترنت** إذا لم توجد نتائج محلية
3. **حفظ النتائج الجديدة** في التخزين المحلي

## 🛠️ الأدوات المتاحة

### في واجهة المستخدم:
- **زر التخزين** (أيقونة التخزين): تحميل البيانات المحلية
- **زر المسح** (أيقونة المسح): مسح جميع البيانات المحلية
- **عرض العدد**: يظهر عدد البيانات المحلية في العنوان
- **رسائل التأكيد**: تأكيد قبل مسح البيانات

### في الكود:
- `NetworkChecker.hasConnection()`: فحص الاتصال
- `QuestionsLocalDb`: إدارة قاعدة البيانات
- `QuestionRepositoryImpl`: تنسيق المصادر
- `QuestionCubit`: إدارة الحالة

## 📊 مزايا التخزين المحلي

1. **سرعة الاستجابة**: البيانات المحلية تُحمل فوراً
2. **العمل بدون إنترنت**: يمكن استخدام التطبيق بدون اتصال
3. **توفير البيانات**: تقليل استهلاك الإنترنت
4. **تجربة مستخدم أفضل**: لا توجد انتظارات طويلة

## 🔍 استكشاف الأخطاء

### إذا لم تظهر البيانات المحلية:
1. تحقق من وجود بيانات محفوظة
2. تحقق من صلاحيات قاعدة البيانات
3. جرب مسح البيانات وإعادة تحميلها

### إذا لم يتم حفظ البيانات:
1. تحقق من مساحة التخزين
2. تحقق من صلاحيات الكتابة
3. تحقق من اتصال الإنترنت

## 📝 ملاحظات مهمة

- البيانات المحلية تُحدث تلقائياً عند جلب بيانات جديدة
- يمكن مسح البيانات المحلية من إعدادات التطبيق
- البحث يعمل في البيانات المحلية أولاً ثم الإنترنت
- التطبيق يحاول استخدام البيانات المحلية عند فشل الاتصال